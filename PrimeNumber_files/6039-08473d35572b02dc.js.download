"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6039],{48652:function(e,n,a){/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var o=a(82038);function h(e,n){return e===n&&(0!==e||1/e==1/n)||e!=e&&n!=n}var l="function"==typeof Object.is?Object.is:h,i=o.useState,s=o.useEffect,c=o.useLayoutEffect,u=o.useDebugValue;function q(e,n){var a=n(),o=i({inst:{value:a,getSnapshot:n}}),l=o[0].inst,d=o[1];return c(function(){l.value=a,l.getSnapshot=n,r(l)&&d({inst:l})},[e,a,n]),s(function(){return r(l)&&d({inst:l}),e(function(){r(l)&&d({inst:l})})},[e]),u(a),a}function r(e){var n=e.getSnapshot;e=e.value;try{var a=n();return!l(e,a)}catch(e){return!0}}function t(e,n){return n()}var d="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?t:q;n.useSyncExternalStore=void 0!==o.useSyncExternalStore?o.useSyncExternalStore:d},33916:function(e,n,a){e.exports=a(48652)},94059:function(e,n,a){a.d(n,{Ns:function(){return N},fC:function(){return V},gb:function(){return C},q4:function(){return U},l_:function(){return j}});var o=a(30516),l=a(82038),i=a(63859),s=a(29862),c=a(76932),u=a(3191),d=a(56396),f=a(35695),p=a(6995);function $ae6933e535247d3d$export$7d15b64cf5a3a4c4(e,[n,a]){return Math.min(a,Math.max(n,e))}var g=a(91036);function $6c2e24571c90391f$export$3e6543de14f8614f(e,n){return(0,l.useReducer)((e,a)=>{let o=n[e][a];return null!=o?o:e},e)}let b="ScrollArea",[m,v]=(0,c.b)(b),[w,y]=m(b),S=(0,l.forwardRef)((e,n)=>{let{__scopeScrollArea:a,type:s="hover",dir:c,scrollHideDelay:d=600,...p}=e,[g,b]=(0,l.useState)(null),[m,v]=(0,l.useState)(null),[y,S]=(0,l.useState)(null),[E,_]=(0,l.useState)(null),[C,R]=(0,l.useState)(null),[$,T]=(0,l.useState)(0),[x,O]=(0,l.useState)(0),[A,k]=(0,l.useState)(!1),[D,P]=(0,l.useState)(!1),L=(0,u.e)(n,e=>b(e)),U=(0,f.gm)(c);return(0,l.createElement)(w,{scope:a,type:s,dir:U,scrollHideDelay:d,scrollArea:g,viewport:m,onViewportChange:v,content:y,onContentChange:S,scrollbarX:E,onScrollbarXChange:_,scrollbarXEnabled:A,onScrollbarXEnabledChange:k,scrollbarY:C,onScrollbarYChange:R,scrollbarYEnabled:D,onScrollbarYEnabledChange:P,onCornerWidthChange:T,onCornerHeightChange:O},(0,l.createElement)(i.WV.div,(0,o.Z)({dir:U},p,{ref:L,style:{position:"relative","--radix-scroll-area-corner-width":$+"px","--radix-scroll-area-corner-height":x+"px",...e.style}})))}),E=(0,l.forwardRef)((e,n)=>{let{__scopeScrollArea:a,children:s,...c}=e,d=y("ScrollAreaViewport",a),f=(0,l.useRef)(null),p=(0,u.e)(n,f,d.onViewportChange);return(0,l.createElement)(l.Fragment,null,(0,l.createElement)("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"}}),(0,l.createElement)(i.WV.div,(0,o.Z)({"data-radix-scroll-area-viewport":""},c,{ref:p,style:{overflowX:d.scrollbarXEnabled?"scroll":"hidden",overflowY:d.scrollbarYEnabled?"scroll":"hidden",...e.style}}),(0,l.createElement)("div",{ref:d.onContentChange,style:{minWidth:"100%",display:"table"}},s)))}),_="ScrollAreaScrollbar",C=(0,l.forwardRef)((e,n)=>{let{forceMount:a,...i}=e,s=y(_,e.__scopeScrollArea),{onScrollbarXEnabledChange:c,onScrollbarYEnabledChange:u}=s,d="horizontal"===e.orientation;return(0,l.useEffect)(()=>(d?c(!0):u(!0),()=>{d?c(!1):u(!1)}),[d,c,u]),"hover"===s.type?(0,l.createElement)(R,(0,o.Z)({},i,{ref:n,forceMount:a})):"scroll"===s.type?(0,l.createElement)($,(0,o.Z)({},i,{ref:n,forceMount:a})):"auto"===s.type?(0,l.createElement)(T,(0,o.Z)({},i,{ref:n,forceMount:a})):"always"===s.type?(0,l.createElement)(x,(0,o.Z)({},i,{ref:n})):null}),R=(0,l.forwardRef)((e,n)=>{let{forceMount:a,...i}=e,c=y(_,e.__scopeScrollArea),[u,d]=(0,l.useState)(!1);return(0,l.useEffect)(()=>{let e=c.scrollArea,n=0;if(e){let handlePointerEnter=()=>{window.clearTimeout(n),d(!0)},handlePointerLeave=()=>{n=window.setTimeout(()=>d(!1),c.scrollHideDelay)};return e.addEventListener("pointerenter",handlePointerEnter),e.addEventListener("pointerleave",handlePointerLeave),()=>{window.clearTimeout(n),e.removeEventListener("pointerenter",handlePointerEnter),e.removeEventListener("pointerleave",handlePointerLeave)}}},[c.scrollArea,c.scrollHideDelay]),(0,l.createElement)(s.z,{present:a||u},(0,l.createElement)(T,(0,o.Z)({"data-state":u?"visible":"hidden"},i,{ref:n})))}),$=(0,l.forwardRef)((e,n)=>{let{forceMount:a,...i}=e,c=y(_,e.__scopeScrollArea),u="horizontal"===e.orientation,d=$57acba87d6e25586$var$useDebounceCallback(()=>p("SCROLL_END"),100),[f,p]=$6c2e24571c90391f$export$3e6543de14f8614f("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return(0,l.useEffect)(()=>{if("idle"===f){let e=window.setTimeout(()=>p("HIDE"),c.scrollHideDelay);return()=>window.clearTimeout(e)}},[f,c.scrollHideDelay,p]),(0,l.useEffect)(()=>{let e=c.viewport,n=u?"scrollLeft":"scrollTop";if(e){let a=e[n],handleScroll=()=>{let o=e[n],l=a!==o;l&&(p("SCROLL"),d()),a=o};return e.addEventListener("scroll",handleScroll),()=>e.removeEventListener("scroll",handleScroll)}},[c.viewport,u,p,d]),(0,l.createElement)(s.z,{present:a||"hidden"!==f},(0,l.createElement)(x,(0,o.Z)({"data-state":"hidden"===f?"hidden":"visible"},i,{ref:n,onPointerEnter:(0,g.M)(e.onPointerEnter,()=>p("POINTER_ENTER")),onPointerLeave:(0,g.M)(e.onPointerLeave,()=>p("POINTER_LEAVE"))})))}),T=(0,l.forwardRef)((e,n)=>{let a=y(_,e.__scopeScrollArea),{forceMount:i,...c}=e,[u,d]=(0,l.useState)(!1),f="horizontal"===e.orientation,p=$57acba87d6e25586$var$useDebounceCallback(()=>{if(a.viewport){let e=a.viewport.offsetWidth<a.viewport.scrollWidth,n=a.viewport.offsetHeight<a.viewport.scrollHeight;d(f?e:n)}},10);return $57acba87d6e25586$var$useResizeObserver(a.viewport,p),$57acba87d6e25586$var$useResizeObserver(a.content,p),(0,l.createElement)(s.z,{present:i||u},(0,l.createElement)(x,(0,o.Z)({"data-state":u?"visible":"hidden"},c,{ref:n})))}),x=(0,l.forwardRef)((e,n)=>{let{orientation:a="vertical",...i}=e,s=y(_,e.__scopeScrollArea),c=(0,l.useRef)(null),u=(0,l.useRef)(0),[d,f]=(0,l.useState)({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),p=$57acba87d6e25586$var$getThumbRatio(d.viewport,d.content),g={...i,sizes:d,onSizesChange:f,hasThumb:!!(p>0&&p<1),onThumbChange:e=>c.current=e,onThumbPointerUp:()=>u.current=0,onThumbPointerDown:e=>u.current=e};function getScrollPosition(e,n){return $57acba87d6e25586$var$getScrollPositionFromPointer(e,u.current,d,n)}return"horizontal"===a?(0,l.createElement)(O,(0,o.Z)({},g,{ref:n,onThumbPositionChange:()=>{if(s.viewport&&c.current){let e=s.viewport.scrollLeft,n=$57acba87d6e25586$var$getThumbOffsetFromScroll(e,d,s.dir);c.current.style.transform=`translate3d(${n}px, 0, 0)`}},onWheelScroll:e=>{s.viewport&&(s.viewport.scrollLeft=e)},onDragScroll:e=>{s.viewport&&(s.viewport.scrollLeft=getScrollPosition(e,s.dir))}})):"vertical"===a?(0,l.createElement)(A,(0,o.Z)({},g,{ref:n,onThumbPositionChange:()=>{if(s.viewport&&c.current){let e=s.viewport.scrollTop,n=$57acba87d6e25586$var$getThumbOffsetFromScroll(e,d);c.current.style.transform=`translate3d(0, ${n}px, 0)`}},onWheelScroll:e=>{s.viewport&&(s.viewport.scrollTop=e)},onDragScroll:e=>{s.viewport&&(s.viewport.scrollTop=getScrollPosition(e))}})):null}),O=(0,l.forwardRef)((e,n)=>{let{sizes:a,onSizesChange:i,...s}=e,c=y(_,e.__scopeScrollArea),[d,f]=(0,l.useState)(),p=(0,l.useRef)(null),g=(0,u.e)(n,p,c.onScrollbarXChange);return(0,l.useEffect)(()=>{p.current&&f(getComputedStyle(p.current))},[p]),(0,l.createElement)(P,(0,o.Z)({"data-orientation":"horizontal"},s,{ref:g,sizes:a,style:{bottom:0,left:"rtl"===c.dir?"var(--radix-scroll-area-corner-width)":0,right:"ltr"===c.dir?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":$57acba87d6e25586$var$getThumbSize(a)+"px",...e.style},onThumbPointerDown:n=>e.onThumbPointerDown(n.x),onDragScroll:n=>e.onDragScroll(n.x),onWheelScroll:(n,a)=>{if(c.viewport){let o=c.viewport.scrollLeft+n.deltaX;e.onWheelScroll(o),o>0&&o<a&&n.preventDefault()}},onResize:()=>{p.current&&c.viewport&&d&&i({content:c.viewport.scrollWidth,viewport:c.viewport.offsetWidth,scrollbar:{size:p.current.clientWidth,paddingStart:$57acba87d6e25586$var$toInt(d.paddingLeft),paddingEnd:$57acba87d6e25586$var$toInt(d.paddingRight)}})}}))}),A=(0,l.forwardRef)((e,n)=>{let{sizes:a,onSizesChange:i,...s}=e,c=y(_,e.__scopeScrollArea),[d,f]=(0,l.useState)(),p=(0,l.useRef)(null),g=(0,u.e)(n,p,c.onScrollbarYChange);return(0,l.useEffect)(()=>{p.current&&f(getComputedStyle(p.current))},[p]),(0,l.createElement)(P,(0,o.Z)({"data-orientation":"vertical"},s,{ref:g,sizes:a,style:{top:0,right:"ltr"===c.dir?0:void 0,left:"rtl"===c.dir?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":$57acba87d6e25586$var$getThumbSize(a)+"px",...e.style},onThumbPointerDown:n=>e.onThumbPointerDown(n.y),onDragScroll:n=>e.onDragScroll(n.y),onWheelScroll:(n,a)=>{if(c.viewport){let o=c.viewport.scrollTop+n.deltaY;e.onWheelScroll(o),o>0&&o<a&&n.preventDefault()}},onResize:()=>{p.current&&c.viewport&&d&&i({content:c.viewport.scrollHeight,viewport:c.viewport.offsetHeight,scrollbar:{size:p.current.clientHeight,paddingStart:$57acba87d6e25586$var$toInt(d.paddingTop),paddingEnd:$57acba87d6e25586$var$toInt(d.paddingBottom)}})}}))}),[k,D]=m(_),P=(0,l.forwardRef)((e,n)=>{let{__scopeScrollArea:a,sizes:s,hasThumb:c,onThumbChange:f,onThumbPointerUp:p,onThumbPointerDown:b,onThumbPositionChange:m,onDragScroll:v,onWheelScroll:w,onResize:S,...E}=e,C=y(_,a),[R,$]=(0,l.useState)(null),T=(0,u.e)(n,e=>$(e)),x=(0,l.useRef)(null),O=(0,l.useRef)(""),A=C.viewport,D=s.content-s.viewport,P=(0,d.W)(w),L=(0,d.W)(m),U=$57acba87d6e25586$var$useDebounceCallback(S,10);function handleDragScroll(e){if(x.current){let n=e.clientX-x.current.left,a=e.clientY-x.current.top;v({x:n,y:a})}}return(0,l.useEffect)(()=>{let handleWheel=e=>{let n=e.target,a=null==R?void 0:R.contains(n);a&&P(e,D)};return document.addEventListener("wheel",handleWheel,{passive:!1}),()=>document.removeEventListener("wheel",handleWheel,{passive:!1})},[A,R,D,P]),(0,l.useEffect)(L,[s,L]),$57acba87d6e25586$var$useResizeObserver(R,U),$57acba87d6e25586$var$useResizeObserver(C.content,U),(0,l.createElement)(k,{scope:a,scrollbar:R,hasThumb:c,onThumbChange:(0,d.W)(f),onThumbPointerUp:(0,d.W)(p),onThumbPositionChange:L,onThumbPointerDown:(0,d.W)(b)},(0,l.createElement)(i.WV.div,(0,o.Z)({},E,{ref:T,style:{position:"absolute",...E.style},onPointerDown:(0,g.M)(e.onPointerDown,e=>{if(0===e.button){let n=e.target;n.setPointerCapture(e.pointerId),x.current=R.getBoundingClientRect(),O.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",C.viewport&&(C.viewport.style.scrollBehavior="auto"),handleDragScroll(e)}}),onPointerMove:(0,g.M)(e.onPointerMove,handleDragScroll),onPointerUp:(0,g.M)(e.onPointerUp,e=>{let n=e.target;n.hasPointerCapture(e.pointerId)&&n.releasePointerCapture(e.pointerId),document.body.style.webkitUserSelect=O.current,C.viewport&&(C.viewport.style.scrollBehavior=""),x.current=null})})))}),L="ScrollAreaThumb",U=(0,l.forwardRef)((e,n)=>{let{forceMount:a,...i}=e,c=D(L,e.__scopeScrollArea);return(0,l.createElement)(s.z,{present:a||c.hasThumb},(0,l.createElement)(z,(0,o.Z)({ref:n},i)))}),z=(0,l.forwardRef)((e,n)=>{let{__scopeScrollArea:a,style:s,...c}=e,d=y(L,a),f=D(L,a),{onThumbPositionChange:p}=f,b=(0,u.e)(n,e=>f.onThumbChange(e)),m=(0,l.useRef)(),v=$57acba87d6e25586$var$useDebounceCallback(()=>{m.current&&(m.current(),m.current=void 0)},100);return(0,l.useEffect)(()=>{let e=d.viewport;if(e){let handleScroll=()=>{if(v(),!m.current){let n=$57acba87d6e25586$var$addUnlinkedScrollListener(e,p);m.current=n,p()}};return p(),e.addEventListener("scroll",handleScroll),()=>e.removeEventListener("scroll",handleScroll)}},[d.viewport,v,p]),(0,l.createElement)(i.WV.div,(0,o.Z)({"data-state":f.hasThumb?"visible":"hidden"},c,{ref:b,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...s},onPointerDownCapture:(0,g.M)(e.onPointerDownCapture,e=>{let n=e.target,a=n.getBoundingClientRect(),o=e.clientX-a.left,l=e.clientY-a.top;f.onThumbPointerDown({x:o,y:l})}),onPointerUp:(0,g.M)(e.onPointerUp,f.onThumbPointerUp)}))}),F="ScrollAreaCorner",I=(0,l.forwardRef)((e,n)=>{let a=y(F,e.__scopeScrollArea),i=!!(a.scrollbarX&&a.scrollbarY),s="scroll"!==a.type&&i;return s?(0,l.createElement)(W,(0,o.Z)({},e,{ref:n})):null}),W=(0,l.forwardRef)((e,n)=>{let{__scopeScrollArea:a,...s}=e,c=y(F,a),[u,d]=(0,l.useState)(0),[f,p]=(0,l.useState)(0);return $57acba87d6e25586$var$useResizeObserver(c.scrollbarX,()=>{var e;let n=(null===(e=c.scrollbarX)||void 0===e?void 0:e.offsetHeight)||0;c.onCornerHeightChange(n),p(n)}),$57acba87d6e25586$var$useResizeObserver(c.scrollbarY,()=>{var e;let n=(null===(e=c.scrollbarY)||void 0===e?void 0:e.offsetWidth)||0;c.onCornerWidthChange(n),d(n)}),u&&f?(0,l.createElement)(i.WV.div,(0,o.Z)({},s,{ref:n,style:{width:u,height:f,position:"absolute",right:"ltr"===c.dir?0:void 0,left:"rtl"===c.dir?0:void 0,bottom:0,...e.style}})):null});function $57acba87d6e25586$var$toInt(e){return e?parseInt(e,10):0}function $57acba87d6e25586$var$getThumbRatio(e,n){let a=e/n;return isNaN(a)?0:a}function $57acba87d6e25586$var$getThumbSize(e){let n=$57acba87d6e25586$var$getThumbRatio(e.viewport,e.content),a=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,o=(e.scrollbar.size-a)*n;return Math.max(o,18)}function $57acba87d6e25586$var$getScrollPositionFromPointer(e,n,a,o="ltr"){let l=$57acba87d6e25586$var$getThumbSize(a),i=n||l/2,s=a.scrollbar.paddingStart+i,c=a.scrollbar.size-a.scrollbar.paddingEnd-(l-i),u=a.content-a.viewport,d=$57acba87d6e25586$var$linearScale([s,c],"ltr"===o?[0,u]:[-1*u,0]);return d(e)}function $57acba87d6e25586$var$getThumbOffsetFromScroll(e,n,a="ltr"){let o=$57acba87d6e25586$var$getThumbSize(n),l=n.scrollbar.paddingStart+n.scrollbar.paddingEnd,i=n.scrollbar.size-l,s=n.content-n.viewport,c="ltr"===a?[0,s]:[-1*s,0],u=$ae6933e535247d3d$export$7d15b64cf5a3a4c4(e,c),d=$57acba87d6e25586$var$linearScale([0,s],[0,i-o]);return d(u)}function $57acba87d6e25586$var$linearScale(e,n){return a=>{if(e[0]===e[1]||n[0]===n[1])return n[0];let o=(n[1]-n[0])/(e[1]-e[0]);return n[0]+o*(a-e[0])}}let $57acba87d6e25586$var$addUnlinkedScrollListener=(e,n=()=>{})=>{let a={left:e.scrollLeft,top:e.scrollTop},o=0;return!function loop(){let l={left:e.scrollLeft,top:e.scrollTop},i=a.left!==l.left,s=a.top!==l.top;(i||s)&&n(),a=l,o=window.requestAnimationFrame(loop)}(),()=>window.cancelAnimationFrame(o)};function $57acba87d6e25586$var$useDebounceCallback(e,n){let a=(0,d.W)(e),o=(0,l.useRef)(0);return(0,l.useEffect)(()=>()=>window.clearTimeout(o.current),[]),(0,l.useCallback)(()=>{window.clearTimeout(o.current),o.current=window.setTimeout(a,n)},[a,n])}function $57acba87d6e25586$var$useResizeObserver(e,n){let a=(0,d.W)(n);(0,p.b)(()=>{let n=0;if(e){let o=new ResizeObserver(()=>{cancelAnimationFrame(n),n=window.requestAnimationFrame(a)});return o.observe(e),()=>{window.cancelAnimationFrame(n),o.unobserve(e)}}},[e,a])}let V=S,j=E,N=I},59524:function(e,n,a){a.d(n,{RJ:function(){return useChat},GO:function(){return useCompletion}});var o,l=a(82038),i=a(33916);let noop=()=>{},s=noop(),c=Object,isUndefined=e=>e===s,isFunction=e=>"function"==typeof e,mergeObjects=(e,n)=>({...e,...n}),isPromiseLike=e=>isFunction(e.then),u=new WeakMap,d=0,stableHash=e=>{let n,a;let o=typeof e,l=e&&e.constructor,i=l==Date;if(c(e)!==e||i||l==RegExp)n=i?e.toJSON():"symbol"==o?e.toString():"string"==o?JSON.stringify(e):""+e;else{if(n=u.get(e))return n;if(n=++d+"~",u.set(e,n),l==Array){for(a=0,n="@";a<e.length;a++)n+=stableHash(e[a])+",";u.set(e,n)}if(l==c){n="#";let o=c.keys(e).sort();for(;!isUndefined(a=o.pop());)isUndefined(e[a])||(n+=a+":"+stableHash(e[a])+",");u.set(e,n)}}return n},f=new WeakMap,p={},g={},b="undefined",m=typeof window!=b,v=typeof document!=b,hasRequestAnimationFrame=()=>m&&typeof window.requestAnimationFrame!=b,createCacheHelper=(e,n)=>{let a=f.get(e);return[()=>!isUndefined(n)&&e.get(n)||p,o=>{if(!isUndefined(n)){let l=e.get(n);n in g||(g[n]=l),a[5](n,mergeObjects(l,o),l||p)}},a[6],()=>!isUndefined(n)&&n in g?g[n]:!isUndefined(n)&&e.get(n)||p]},w=!0,[y,S]=m&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[noop,noop],E={initFocus:e=>(v&&document.addEventListener("visibilitychange",e),y("focus",e),()=>{v&&document.removeEventListener("visibilitychange",e),S("focus",e)}),initReconnect:e=>{let onOnline=()=>{w=!0,e()},onOffline=()=>{w=!1};return y("online",onOnline),y("offline",onOffline),()=>{S("online",onOnline),S("offline",onOffline)}}},_=!l.useId,C=!m||"Deno"in window,rAF=e=>hasRequestAnimationFrame()?window.requestAnimationFrame(e):setTimeout(e,1),R=C?l.useEffect:l.useLayoutEffect,$="undefined"!=typeof navigator&&navigator.connection,T=!C&&$&&(["slow-2g","2g"].includes($.effectiveType)||$.saveData),dist_serialize=e=>{if(isFunction(e))try{e=e()}catch(n){e=""}let n=e;return[e="string"==typeof e?e:(Array.isArray(e)?e.length:e)?stableHash(e):"",n]},x=0,getTimestamp=()=>++x;var O={ERROR_REVALIDATE_EVENT:3,FOCUS_EVENT:0,MUTATE_EVENT:2,RECONNECT_EVENT:1};async function internalMutate(...e){let[n,a,o,l]=e,i=mergeObjects({populateCache:!0,throwOnError:!0},"boolean"==typeof l?{revalidate:l}:l||{}),c=i.populateCache,u=i.rollbackOnError,d=i.optimisticData,p=!1!==i.revalidate,rollbackOnError=e=>"function"==typeof u?u(e):!1!==u,g=i.throwOnError;if(isFunction(a)){let e=[],o=n.keys();for(let l of o)!/^\$(inf|sub)\$/.test(l)&&a(n.get(l)._k)&&e.push(l);return Promise.all(e.map(mutateByKey))}return mutateByKey(a);async function mutateByKey(a){let l;let[i]=dist_serialize(a);if(!i)return;let[u,b]=createCacheHelper(n,i),[m,v,w,y]=f.get(n),S=m[i],startRevalidate=()=>p&&(delete w[i],delete y[i],S&&S[0])?S[0](2).then(()=>u().data):u().data;if(e.length<3)return startRevalidate();let E=o,_=getTimestamp();v[i]=[_,0];let C=!isUndefined(d),R=u(),$=R.data,T=R._c,x=isUndefined(T)?$:T;if(C&&b({data:d=isFunction(d)?d(x,$):d,_c:x}),isFunction(E))try{E=E(x)}catch(e){l=e}if(E&&isPromiseLike(E)){if(E=await E.catch(e=>{l=e}),_!==v[i][0]){if(l)throw l;return E}l&&C&&rollbackOnError(l)&&(c=!0,b({data:E=x,_c:s}))}c&&!l&&(isFunction(c)&&(E=c(E,x)),b({data:E,error:s,_c:s})),v[i][1]=getTimestamp();let O=await startRevalidate();if(b({_c:s}),l){if(g)throw l;return}return c?O:E}}let revalidateAllKeys=(e,n)=>{for(let a in e)e[a][0]&&e[a][0](n)},initCache=(e,n)=>{if(!f.has(e)){let a=mergeObjects(E,n),o={},l=internalMutate.bind(s,e),i=noop,c={},subscribe=(e,n)=>{let a=c[e]||[];return c[e]=a,a.push(n),()=>a.splice(a.indexOf(n),1)},setter=(n,a,o)=>{e.set(n,a);let l=c[n];if(l)for(let e of l)e(a,o)},initProvider=()=>{if(!f.has(e)&&(f.set(e,[o,{},{},{},l,setter,subscribe]),!C)){let n=a.initFocus(setTimeout.bind(s,revalidateAllKeys.bind(s,o,0))),l=a.initReconnect(setTimeout.bind(s,revalidateAllKeys.bind(s,o,1)));i=()=>{n&&n(),l&&l(),f.delete(e)}}};return initProvider(),[e,l,initProvider,i]}return[e,f.get(e)[4]]},[A,k]=initCache(new Map),D=mergeObjects({onLoadingSlow:noop,onSuccess:noop,onError:noop,onErrorRetry:(e,n,a,o,l)=>{let i=a.errorRetryCount,s=l.retryCount,c=~~((Math.random()+.5)*(1<<(s<8?s:8)))*a.errorRetryInterval;(isUndefined(i)||!(s>i))&&setTimeout(o,c,l)},onDiscarded:noop,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:T?1e4:5e3,focusThrottleInterval:5e3,dedupingInterval:2e3,loadingTimeout:T?5e3:3e3,compare:(e,n)=>stableHash(e)==stableHash(n),isPaused:()=>!1,cache:A,mutate:k,fallback:{}},{isOnline:()=>w,isVisible:()=>{let e=v&&document.visibilityState;return isUndefined(e)||"hidden"!==e}}),mergeConfigs=(e,n)=>{let a=mergeObjects(e,n);if(n){let{use:o,fallback:l}=e,{use:i,fallback:s}=n;o&&i&&(a.use=o.concat(i)),l&&s&&(a.fallback=mergeObjects(l,s))}return a},P=(0,l.createContext)({}),L=m&&window.__SWR_DEVTOOLS_USE__,U=L?window.__SWR_DEVTOOLS_USE__:[],normalize=e=>isFunction(e[1])?[e[0],e[1],e[2]||{}]:[e[0],null,(null===e[1]?e[2]:e[1])||{}],useSWRConfig=()=>mergeObjects(D,(0,l.useContext)(P)),z=U.concat(e=>(n,a,o)=>{let l=a&&((...e)=>{let[o]=dist_serialize(n),[,,,l]=f.get(A),i=l[o];return isUndefined(i)?a(...e):(delete l[o],i)});return e(n,l,o)}),subscribeCallback=(e,n,a)=>{let o=n[e]||(n[e]=[]);return o.push(a),()=>{let e=o.indexOf(a);e>=0&&(o[e]=o[o.length-1],o.pop())}};L&&(window.__SWR_DEVTOOLS_REACT__=l);let F=l.use||(e=>{if("pending"===e.status)throw e;if("fulfilled"===e.status)return e.value;if("rejected"===e.status)throw e.reason;throw e.status="pending",e.then(n=>{e.status="fulfilled",e.value=n},n=>{e.status="rejected",e.reason=n}),e}),I={dedupe:!0};c.defineProperty(e=>{let{value:n}=e,a=(0,l.useContext)(P),o=isFunction(n),i=(0,l.useMemo)(()=>o?n(a):n,[o,a,n]),c=(0,l.useMemo)(()=>o?i:mergeConfigs(a,i),[o,a,i]),u=i&&i.provider,d=(0,l.useRef)(s);u&&!d.current&&(d.current=initCache(u(c.cache||A),i));let f=d.current;return f&&(c.cache=f[0],c.mutate=f[1]),R(()=>{if(f)return f[2]&&f[2](),f[3]},[]),(0,l.createElement)(P.Provider,mergeObjects(e,{value:c}))},"defaultValue",{value:D});let W=(o=(e,n,a)=>{let{cache:o,compare:c,suspense:u,fallbackData:d,revalidateOnMount:p,revalidateIfStale:g,refreshInterval:b,refreshWhenHidden:m,refreshWhenOffline:v,keepPreviousData:w}=a,[y,S,E,$]=f.get(o),[T,x]=dist_serialize(e),A=(0,l.useRef)(!1),k=(0,l.useRef)(!1),D=(0,l.useRef)(T),P=(0,l.useRef)(n),L=(0,l.useRef)(a),getConfig=()=>L.current,isActive=()=>getConfig().isVisible()&&getConfig().isOnline(),[U,z,W,V]=createCacheHelper(o,T),j=(0,l.useRef)({}).current,N=isUndefined(d)?a.fallback[T]:d,isEqual=(e,n)=>{for(let a in j)if("data"===a){if(!c(e[a],n[a])&&(!isUndefined(e[a])||!c(G,n[a])))return!1}else if(n[a]!==e[a])return!1;return!0},M=(0,l.useMemo)(()=>{let e=!!T&&!!n&&(isUndefined(p)?!getConfig().isPaused()&&!u&&(!!isUndefined(g)||g):p),getSelectedCache=n=>{let a=mergeObjects(n);return(delete a._k,e)?{isValidating:!0,isLoading:!0,...a}:a},a=U(),o=V(),l=getSelectedCache(a),i=a===o?l:getSelectedCache(o),s=l;return[()=>{let e=getSelectedCache(U()),n=isEqual(e,s);return n?(s.data=e.data,s.isLoading=e.isLoading,s.isValidating=e.isValidating,s.error=e.error,s):(s=e,e)},()=>i]},[o,T]),H=(0,i.useSyncExternalStore)((0,l.useCallback)(e=>W(T,(n,a)=>{isEqual(a,n)||e()}),[o,T]),M[0],M[1]),Z=!A.current,X=y[T]&&y[T].length>0,Y=H.data,B=isUndefined(Y)?N:Y,J=H.error,K=(0,l.useRef)(B),G=w?isUndefined(Y)?K.current:Y:B,Q=(!X||!!isUndefined(J))&&(Z&&!isUndefined(p)?p:!getConfig().isPaused()&&(u?!isUndefined(B)&&g:isUndefined(B)||g)),ee=!!(T&&n&&Z&&Q),et=isUndefined(H.isValidating)?ee:H.isValidating,er=isUndefined(H.isLoading)?ee:H.isLoading,en=(0,l.useCallback)(async e=>{let n,o;let l=P.current;if(!T||!l||k.current||getConfig().isPaused())return!1;let i=!0,u=e||{},d=!E[T]||!u.dedupe,callbackSafeguard=()=>_?!k.current&&T===D.current&&A.current:T===D.current,f={isValidating:!1,isLoading:!1},finishRequestAndUpdateState=()=>{z(f)},cleanupState=()=>{let e=E[T];e&&e[1]===o&&delete E[T]},p={isValidating:!0};isUndefined(U().data)&&(p.isLoading=!0);try{if(d&&(z(p),a.loadingTimeout&&isUndefined(U().data)&&setTimeout(()=>{i&&callbackSafeguard()&&getConfig().onLoadingSlow(T,a)},a.loadingTimeout),E[T]=[l(x),getTimestamp()]),[n,o]=E[T],n=await n,d&&setTimeout(cleanupState,a.dedupingInterval),!E[T]||E[T][1]!==o)return d&&callbackSafeguard()&&getConfig().onDiscarded(T),!1;f.error=s;let e=S[T];if(!isUndefined(e)&&(o<=e[0]||o<=e[1]||0===e[1]))return finishRequestAndUpdateState(),d&&callbackSafeguard()&&getConfig().onDiscarded(T),!1;let u=U().data;f.data=c(u,n)?u:n,d&&callbackSafeguard()&&getConfig().onSuccess(n,T,a)}catch(a){cleanupState();let e=getConfig(),{shouldRetryOnError:n}=e;!e.isPaused()&&(f.error=a,d&&callbackSafeguard()&&(e.onError(a,T,e),(!0===n||isFunction(n)&&n(a))&&isActive()&&e.onErrorRetry(a,T,e,e=>{let n=y[T];n&&n[0]&&n[0](O.ERROR_REVALIDATE_EVENT,e)},{retryCount:(u.retryCount||0)+1,dedupe:!0})))}return i=!1,finishRequestAndUpdateState(),!0},[T,o]),ea=(0,l.useCallback)((...e)=>internalMutate(o,D.current,...e),[]);if(R(()=>{P.current=n,L.current=a,isUndefined(Y)||(K.current=Y)}),R(()=>{if(!T)return;let e=en.bind(s,I),n=0,a=subscribeCallback(T,y,(a,o={})=>{if(a==O.FOCUS_EVENT){let a=Date.now();getConfig().revalidateOnFocus&&a>n&&isActive()&&(n=a+getConfig().focusThrottleInterval,e())}else if(a==O.RECONNECT_EVENT)getConfig().revalidateOnReconnect&&isActive()&&e();else if(a==O.MUTATE_EVENT)return en();else if(a==O.ERROR_REVALIDATE_EVENT)return en(o)});return k.current=!1,D.current=T,A.current=!0,z({_k:x}),Q&&(isUndefined(B)||C?e():rAF(e)),()=>{k.current=!0,a()}},[T]),R(()=>{let e;function next(){let n=isFunction(b)?b(U().data):b;n&&-1!==e&&(e=setTimeout(execute,n))}function execute(){!U().error&&(m||getConfig().isVisible())&&(v||getConfig().isOnline())?en(I).then(next):next()}return next(),()=>{e&&(clearTimeout(e),e=-1)}},[b,m,v,T]),(0,l.useDebugValue)(G),u&&isUndefined(B)&&T){if(!_&&C)throw Error("Fallback data is required when using suspense in SSR.");P.current=n,L.current=a,k.current=!1;let e=$[T];if(!isUndefined(e)){let n=ea(e);F(n)}if(isUndefined(J)){let e=en(I);isUndefined(G)||(e.status="fulfilled",e.value=!0),F(e)}else throw J}return{mutate:ea,get data(){return j.data=!0,G},get error(){return j.error=!0,J},get isValidating(){return j.isValidating=!0,et},get isLoading(){return j.isLoading=!0,er}}},function(...e){let n=useSWRConfig(),[a,l,i]=normalize(e),s=mergeConfigs(n,i),c=o,{use:u}=s,d=(u||[]).concat(z);for(let e=d.length;e--;)c=d[e](c);return c(a,l||s.fetcher||null,s)});var V=a(78249),j={code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},N={code:"1",name:"function_call",parse:e=>{if(null==e||"object"!=typeof e||!("function_call"in e)||"object"!=typeof e.function_call||null==e.function_call||!("name"in e.function_call)||!("arguments"in e.function_call)||"string"!=typeof e.function_call.name||"string"!=typeof e.function_call.arguments)throw Error('"function_call" parts expect an object with a "function_call" property.');return{type:"function_call",value:e}}},M={code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw Error('"data" parts expect an array value.');return{type:"data",value:e}}},H={code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},Z={code:"4",name:"assistant_message",parse:e=>{if(null==e||"object"!=typeof e||!("id"in e)||!("role"in e)||!("content"in e)||"string"!=typeof e.id||"string"!=typeof e.role||"assistant"!==e.role||!Array.isArray(e.content)||!e.content.every(e=>null!=e&&"object"==typeof e&&"type"in e&&"text"===e.type&&"text"in e&&null!=e.text&&"object"==typeof e.text&&"value"in e.text&&"string"==typeof e.text.value))throw Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},X={code:"5",name:"assistant_control_data",parse:e=>{if(null==e||"object"!=typeof e||!("threadId"in e)||!("messageId"in e)||"string"!=typeof e.threadId||"string"!=typeof e.messageId)throw Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},Y={code:"6",name:"data_message",parse:e=>{if(null==e||"object"!=typeof e||!("role"in e)||!("data"in e)||"string"!=typeof e.role||"data"!==e.role)throw Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},B={code:"7",name:"tool_calls",parse:e=>{if(null==e||"object"!=typeof e||!("tool_calls"in e)||"object"!=typeof e.tool_calls||null==e.tool_calls||!Array.isArray(e.tool_calls)||e.tool_calls.some(e=>{null!=e&&"object"==typeof e&&"id"in e&&"string"==typeof e.id&&"type"in e&&"string"==typeof e.type&&"function"in e&&null!=e.function&&"object"==typeof e.function&&"arguments"in e.function&&"string"==typeof e.function.name&&e.function.arguments}))throw Error('"tool_calls" parts expect an object with a ToolCallPayload.');return{type:"tool_calls",value:e}}},J={[j.code]:j,[N.code]:N,[M.code]:M,[H.code]:H,[Z.code]:Z,[X.code]:X,[Y.code]:Y,[B.code]:B};j.name,j.code,N.name,N.code,M.name,M.code,H.name,H.code,Z.name,Z.code,X.name,X.code,Y.name,Y.code,B.name,B.code;var K=[j,N,M,H,Z,X,Y,B].map(e=>e.code),parseStreamPart=e=>{let n=e.indexOf(":");if(-1===n)throw Error("Failed to parse stream string. No separator found.");let a=e.slice(0,n);if(!K.includes(a))throw Error(`Failed to parse stream string. Invalid code ${a}.`);let o=e.slice(n+1),l=JSON.parse(o);return J[a].parse(l)};function concatChunks(e,n){let a=new Uint8Array(n),o=0;for(let n of e)a.set(n,o),o+=n.length;return e.length=0,a}async function*readDataStream(e,{isAborted:n}={}){let a=new TextDecoder,o=[],l=0;for(;;){let{value:i}=await e.read();if(i&&(o.push(i),l+=i.length,10!==i[i.length-1]))continue;if(0===o.length)break;let s=concatChunks(o,l);l=0;let c=a.decode(s,{stream:!0}).split("\n").filter(e=>""!==e).map(parseStreamPart);for(let e of c)yield e;if(null==n?void 0:n()){e.cancel();break}}}var G=(0,V.k)("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",7);function createChunkDecoder(e){let n=new TextDecoder;return e?function(e){let a=n.decode(e,{stream:!0}).split("\n").filter(e=>""!==e);return a.map(parseStreamPart).filter(Boolean)}:function(e){return e?n.decode(e,{stream:!0}):""}}var Q="X-Experimental-Stream-Data";async function parseComplexResponse({reader:e,abortControllerRef:n,update:a,onFinish:o,generateId:l=G,getCurrentDate:i=()=>new Date}){let s=i(),c={data:[]};for await(let{type:o,value:i}of readDataStream(e,{isAborted:()=>(null==n?void 0:n.current)===null})){"text"===o&&(c.text?c.text={...c.text,content:(c.text.content||"")+i}:c.text={id:l(),role:"assistant",content:i,createdAt:s});let e=null;"function_call"===o&&(c.function_call={id:l(),role:"assistant",content:"",function_call:i.function_call,name:i.function_call.name,createdAt:s},e=c.function_call);let n=null;"tool_calls"===o&&(c.tool_calls={id:l(),role:"assistant",content:"",tool_calls:i.tool_calls,createdAt:s},n=c.tool_calls),"data"===o&&c.data.push(...i);let u=c.text,d=[e,n,u].filter(Boolean);a(d,[...c.data])}return null==o||o(c),{messages:[c.text,c.function_call,c.tool_calls].filter(Boolean),data:c.data}}async function callChatApi({api:e,messages:n,body:a,credentials:o,headers:l,abortController:i,appendMessage:s,restoreMessagesOnFailure:c,onResponse:u,onUpdate:d,onFinish:f,generateId:p}){var g;let b=await fetch(e,{method:"POST",body:JSON.stringify({messages:n,...a}),headers:{"Content-Type":"application/json",...l},signal:null==(g=null==i?void 0:i())?void 0:g.signal,credentials:o}).catch(e=>{throw c(),e});if(u)try{await u(b)}catch(e){throw e}if(!b.ok)throw c(),Error(await b.text()||"Failed to fetch the chat response.");if(!b.body)throw Error("The response body is empty.");let m=b.body.getReader(),v="true"===b.headers.get(Q);if(v)return await parseComplexResponse({reader:m,abortControllerRef:null!=i?{current:i()}:void 0,update:d,onFinish(e){f&&null!=e.text&&f(e.text)},generateId:p});{let e=new Date,n=createChunkDecoder(!1),a="",o=p(),l={id:o,createdAt:e,content:"",role:"assistant"};for(;;){let{done:e,value:o}=await m.read();if(e)break;if((a+=n(o)).startsWith('{"function_call":')?l.function_call=a:a.startsWith('{"tool_calls":')?l.tool_calls=a:l.content=a,s({...l}),(null==i?void 0:i())===null){m.cancel();break}}if(a.startsWith('{"function_call":')){let e=JSON.parse(a).function_call;l.function_call=e,s({...l})}if(a.startsWith('{"tool_calls":')){let e=JSON.parse(a).tool_calls;l.tool_calls=e,s({...l})}return f&&f(l),l}}async function processChatStream({getStreamedResponse:e,experimental_onFunctionCall:n,experimental_onToolCall:a,updateChatRequest:o,getCurrentMessages:l}){for(;;){let i=await e();if("messages"in i){let e=!1;for(let s of i.messages)if(void 0!==s.function_call&&"string"!=typeof s.function_call||void 0!==s.tool_calls&&"string"!=typeof s.tool_calls){if(e=!0,n){let a=s.function_call;if("object"!=typeof a){console.warn("experimental_onFunctionCall should not be defined when using tools");continue}let i=await n(l(),a);if(void 0===i){e=!1;break}o(i)}if(a){let n=s.tool_calls;if(!Array.isArray(n)||n.some(e=>"object"!=typeof e)){console.warn("experimental_onToolCall should not be defined when using tools");continue}let i=await a(l(),n);if(void 0===i){e=!1;break}o(i)}}if(!e)break}else{let fixFunctionCallArguments2=function(e){for(let n of e.messages){if(void 0!==n.tool_calls)for(let e of n.tool_calls)"object"==typeof e&&e.function.arguments&&"string"!=typeof e.function.arguments&&(e.function.arguments=JSON.stringify(e.function.arguments));void 0!==n.function_call&&"object"==typeof n.function_call&&n.function_call.arguments&&"string"!=typeof n.function_call.arguments&&(n.function_call.arguments=JSON.stringify(n.function_call.arguments))}};if((void 0===i.function_call||"string"==typeof i.function_call)&&(void 0===i.tool_calls||"string"==typeof i.tool_calls))break;if(n){let e=i.function_call;if("object"!=typeof e){console.warn("experimental_onFunctionCall should not be defined when using tools");continue}let a=await n(l(),e);if(void 0===a)break;fixFunctionCallArguments2(a),o(a)}if(a){let e=i.tool_calls;if("object"!=typeof e){console.warn("experimental_onToolCall should not be defined when using functions");continue}let n=await a(l(),e);if(void 0===n)break;fixFunctionCallArguments2(n),o(n)}}}}var getStreamedResponse=async(e,n,a,o,l,i,s,c,u,d,f,p)=>{var g,b;let m=s.current;a(n.messages,!1);let v=p?n.messages:n.messages.map(({role:e,content:n,name:a,function_call:o,tool_calls:l,tool_call_id:i})=>({role:e,content:n,tool_call_id:i,...void 0!==a&&{name:a},...void 0!==o&&{function_call:o},...void 0!==l&&{tool_calls:l}}));if("string"!=typeof e){let o=u(),l=new Date,i={id:o,createdAt:l,content:"",role:"assistant"};async function readRow(e){let{content:o,ui:l,next:s}=await e;i.content=o,i.ui=await l,a([...n.messages,{...i}],!1),s&&await readRow(s)}try{let a=e({messages:v,data:n.data});await readRow(a)}catch(e){throw a(m,!1),e}return d&&d(i),i}return await callChatApi({api:e,messages:v,body:{data:n.data,...i.current.body,...null==(g=n.options)?void 0:g.body,...void 0!==n.functions&&{functions:n.functions},...void 0!==n.function_call&&{function_call:n.function_call},...void 0!==n.tools&&{tools:n.tools},...void 0!==n.tool_choice&&{tool_choice:n.tool_choice}},credentials:i.current.credentials,headers:{...i.current.headers,...null==(b=n.options)?void 0:b.headers},abortController:()=>c.current,appendMessage(e){a([...n.messages,e],!1)},restoreMessagesOnFailure(){a(m,!1)},onResponse:f,onUpdate(e,i){a([...n.messages,...e],!1),o([...l||[],...i||[]],!1)},onFinish:d,generateId:u})};function useChat({api:e="/api/chat",id:n,initialMessages:a,initialInput:o="",sendExtraMessageFields:i,experimental_onFunctionCall:s,experimental_onToolCall:c,onResponse:u,onFinish:d,onError:f,credentials:p,headers:g,body:b,generateId:m=G}={}){let v=(0,l.useId)(),w=null!=n?n:v,y="string"==typeof e?[e,w]:w,[S]=(0,l.useState)([]),{data:E,mutate:_}=W([y,"messages"],null,{fallbackData:null!=a?a:S}),{data:C=!1,mutate:R}=W([y,"loading"],null),{data:$,mutate:T}=W([y,"streamData"],null),{data:x,mutate:O}=W([y,"error"],null),A=(0,l.useRef)(E||[]);(0,l.useEffect)(()=>{A.current=E||[]},[E]);let k=(0,l.useRef)(null),D=(0,l.useRef)({credentials:p,headers:g,body:b});(0,l.useEffect)(()=>{D.current={credentials:p,headers:g,body:b}},[p,g,b]);let P=(0,l.useCallback)(async n=>{try{R(!0),O(void 0);let a=new AbortController;k.current=a,await processChatStream({getStreamedResponse:()=>getStreamedResponse(e,n,_,T,$,D,A,k,m,d,u,i),experimental_onFunctionCall:s,experimental_onToolCall:c,updateChatRequest:e=>{n=e},getCurrentMessages:()=>A.current}),k.current=null}catch(e){if("AbortError"===e.name)return k.current=null,null;f&&e instanceof Error&&f(e),O(e)}finally{R(!1)}},[_,R,e,D,u,d,f,O,T,$,i,s,c,A,k,m]),L=(0,l.useCallback)(async(e,{options:n,functions:a,function_call:o,tools:l,tool_choice:i,data:s}={})=>{e.id||(e.id=m());let c={messages:A.current.concat(e),options:n,data:s,...void 0!==a&&{functions:a},...void 0!==o&&{function_call:o},...void 0!==l&&{tools:l},...void 0!==i&&{tool_choice:i}};return P(c)},[P,m]),U=(0,l.useCallback)(async({options:e,functions:n,function_call:a,tools:o,tool_choice:l}={})=>{if(0===A.current.length)return null;let i=A.current[A.current.length-1];if("assistant"===i.role){let i={messages:A.current.slice(0,-1),options:e,...void 0!==n&&{functions:n},...void 0!==a&&{function_call:a},...void 0!==o&&{tools:o},...void 0!==l&&{tool_choice:l}};return P(i)}let s={messages:A.current,options:e,...void 0!==n&&{functions:n},...void 0!==a&&{function_call:a},...void 0!==o&&{tools:o},...void 0!==l&&{tool_choice:l}};return P(s)},[P]),z=(0,l.useCallback)(()=>{k.current&&(k.current.abort(),k.current=null)},[]),F=(0,l.useCallback)(e=>{_(e,!1),A.current=e},[_]),[I,V]=(0,l.useState)(o),j=(0,l.useCallback)((e,n={},a)=>{a&&(D.current={...D.current,...a}),e.preventDefault(),I&&(L({content:I,role:"user",createdAt:new Date},n),V(""))},[I,L]);return{messages:E||[],error:x,append:L,reload:U,stop:z,setMessages:F,input:I,setInput:V,handleInputChange:e=>{V(e.target.value)},handleSubmit:j,isLoading:C,data:$}}async function callCompletionApi({api:e,prompt:n,credentials:a,headers:o,body:l,setCompletion:i,setLoading:s,setError:c,setAbortController:u,onResponse:d,onFinish:f,onError:p,onData:g}){try{s(!0),c(void 0);let p=new AbortController;u(p),i("");let b=await fetch(e,{method:"POST",body:JSON.stringify({prompt:n,...l}),credentials:a,headers:{"Content-Type":"application/json",...o},signal:p.signal}).catch(e=>{throw e});if(d)try{await d(b)}catch(e){throw e}if(!b.ok)throw Error(await b.text()||"Failed to fetch the chat response.");if(!b.body)throw Error("The response body is empty.");let m="",v=b.body.getReader(),w="true"===b.headers.get(Q);if(w)for await(let{type:e,value:n}of readDataStream(v,{isAborted:()=>null===p}))switch(e){case"text":m+=n,i(m);break;case"data":null==g||g(n)}else{let e=createChunkDecoder();for(;;){let{done:n,value:a}=await v.read();if(n)break;if(m+=e(a),i(m),null===p){v.cancel();break}}}return f&&f(n,m),u(null),m}catch(e){if("AbortError"===e.name)return u(null),null;e instanceof Error&&p&&p(e),c(e)}finally{s(!1)}}function useCompletion({api:e="/api/completion",id:n,initialCompletion:a="",initialInput:o="",credentials:i,headers:s,body:c,onResponse:u,onFinish:d,onError:f}={}){let p=(0,l.useId)(),g=n||p,{data:b,mutate:m}=W([e,g],null,{fallbackData:a}),{data:v=!1,mutate:w}=W([g,"loading"],null),{data:y,mutate:S}=W([g,"streamData"],null),[E,_]=(0,l.useState)(void 0),[C,R]=(0,l.useState)(null),$=(0,l.useRef)({credentials:i,headers:s,body:c});(0,l.useEffect)(()=>{$.current={credentials:i,headers:s,body:c}},[i,s,c]);let T=(0,l.useCallback)(async(n,a)=>callCompletionApi({api:e,prompt:n,credentials:$.current.credentials,headers:{...$.current.headers,...null==a?void 0:a.headers},body:{...$.current.body,...null==a?void 0:a.body},setCompletion:e=>m(e,!1),setLoading:w,setError:_,setAbortController:R,onResponse:u,onFinish:d,onError:f,onData:e=>{S([...y||[],...e||[]],!1)}}),[m,w,e,$,R,u,d,f,_,y,S]),x=(0,l.useCallback)(()=>{C&&(C.abort(),R(null))},[C]),O=(0,l.useCallback)(e=>{m(e,!1)},[m]),A=(0,l.useCallback)(async(e,n)=>T(e,n),[T]),[k,D]=(0,l.useState)(o),P=(0,l.useCallback)(e=>{if(e.preventDefault(),k)return A(k)},[k,A]);return{completion:b,complete:A,error:E,setCompletion:O,stop:x,input:k,setInput:D,handleInputChange:e=>{D(e.target.value)},handleSubmit:P,isLoading:v,data:y}}},78249:function(e,n,a){a.d(n,{k:function(){return customAlphabet}});let customAlphabet=(e,n=21)=>(a=n)=>{let o="",l=a;for(;l--;)o+=e[Math.random()*e.length|0];return o}}}]);